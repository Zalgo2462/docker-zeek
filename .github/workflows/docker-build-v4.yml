name: Build and Publish Zeek v4 Docker Images

on:
  push:
    branches: [ master, zeek-v4 ]
    paths:
      # Paths that trigger a docker image build
      - '.github/workflows/docker-build-v4.yml'
      - '.github/workflows/docker-build/**'      
      - 'etc/**'
      - 'share/**'
      - 'docker-entrypoint.sh'
      - 'Dockerfile'

jobs:
  build:
    name: Build Zeek release
    runs-on: ubuntu-latest
    strategy:
      matrix:
        # allows using the same build steps for multiple versions
        include:
          - version: "4.2.0"
            af-packet: "3.0.2"
            zkg: "2.12.0"
            tag: latest
          - version: "4.0.5"
            af-packet: "3.0.2"
            zkg: "2.12.0"
            tag: lts

    steps:
    - 
      name: Checkout code
      uses: actions/checkout@v2
    -
      name: Build and publish Docker images
      uses: ./.github/workflows/build-docker-zeek
      with:
        DOCKER_USERNAME: "${{ secrets.DOCKER_USERNAME }}"
        DOCKER_TOKEN: "${{ secrets.DOCKER_TOKEN }}"
        version: "${{ matrix.version }}"
        af-packet: "${{ matrix.af-packet }}"
        zkg: "${{ matrix.zkg }}"
        tag: "${{ matrix.tag }}"